# Version 0.1
# Splunk install
$splunkinstall = <<-SCRIPT
        # Package installing
        sudo yum localinstall /vagrant/splunk-8.0.6-152fb4b2bb96-linux-2.6-x86_64.rpm -y
  # Setup Splunk config
        sudo /opt/splunk/bin/splunk enable boot-start -user splunk -systemd-managed 1 --accept-license  --seed-passwd changeme
  sudo /opt/splunk/bin/splunk start  --no-prompt 
SCRIPT

# Command system/custom/add packages ....
$systeminstall = <<-SCRIPT
        #Set timezone
        timedatectl set-timezone 'Europe/Paris'
SCRIPT

#Get IP to display after vagrant up
$getip= <<-SCRIPT
  ip -4 addr sh eth1
SCRIPT

#Message post up
$postupmessage = <<-SCRIPT
  VM/box generate by Vagrant !
SCRIPT

#Config box
Vagrant.configure("2") do |config|
  config.vm.define "vm1" do |vm1|
    vm1.vm.provider "virtualbox" do |v|
      v.memory = 2048
      v.cpus = 2
    end
    vm1.vm.box = "centos/7"
    vm1.vm.hostname = 'vm1'
    vm1.vm.box_url = "centos/7"
    vm1.vm.network "forwarded_port", guest: 8000, host: 8000
    # vm1.vm.network "forwarded_port", guest: 9997, host: 9997
    vm1.vm.network "forwarded_port", guest: 8089, host: 8089 
    vm1.vm.network "public_network", bridge: "en0: Wi-Fi (AirPort)", auto_config: false
    vm1.vm.provision "file", source: "~/Downloads/splunk-8.0.6-152fb4b2bb96-linux-2.6-x86_64.rpm", destination: "/vagrant/"
    vm1.vm.provision "shell", inline: $splunkinstall
    vm1.vm.provision "shell", inline: $systeminstall
    vm1.vm.provision "shell", inline: $getip, run: "always"
    vm1.vm.post_up_message = $postupmessage
    #vm1.vm.provision "shell", inline: "ip -4 addr sh eth1", run: "always"
  end
end
